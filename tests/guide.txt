GUIDE: How to Configure Apache for NSE Script Testing

This guide outlines the step-by-step process for configuring a local Apache2 server to test the vulnTLSServer.lua NSE script. The methodology involves running a series of isolated tests, where each test uses a specific certificate and server configuration to check for a unique vulnerability.

---
## 1. File Naming Convention

Each test is numbered (e.g., "test01", "test02") and has three associated files:

1.  **openssl_test0x.txt**: A text file containing the OpenSSL shell commands needed to generate the specific certificate (`.pem` and `.key`) for this test.
2.  **default-ssl-test0x.conf**: The Apache SSL configuration file. It's pre-configured to point to the certificate from step 1 and enable/disable the specific TLS protocols or ciphers for this test.
3.  **test0x.out**: The final Nmap output file generated by running the script against the server configured for this test.
4.  **test0x.txt** Explanation of the test

---
## 2. One-Time Setup

Before starting, you must have a folder where Apache can find the certificates you generate.

1.  Create the certificate directory:
    sudo mkdir -p /etc/apache2/my_certs

2.  Ensure the Apache SSL module and default SSL site are enabled (you only need to do this once):
    sudo a2enmod ssl
    sudo a2ensite default-ssl

---
## 3. Step-by-Step Testing Workflow (Example for Test01)

Follow this *entire* cycle for each test (e.g., test01, test02, test03).

### Step 1: Generate the Certificate

1.  Find the commands for the current test in its `openssl_test0x.txt` file.
    (e.g., for Test 01, you would look at `openssl_test01.txt`)

2.  Execute those commands in your terminal to generate the certificate and key files (e.g., `test01_good_cert.pem` and `test01_good_key.pem`).

### Step 2: Move the Certificate

1.  Move the newly created `.pem` and `.key` files to the Apache certificate directory you created earlier.

    sudo mv test01_good_cert.pem /etc/apache2/my_certs/
    sudo mv test01_good_key.key /etc/apache2/my_certs/

### Step 3: Apply the Apache Configuration

1.  Copy the pre-made `.conf` file for this test over the *active* Apache configuration file. This is the most important step.

    (Example for Test 01):
    sudo cp default-ssl-test01.conf /etc/apache2/sites-available/default-ssl.conf

### Step 4: Restart and Verify Apache

1.  Restart the Apache service to load the new configuration:
    sudo systemctl restart apache2

2.  **CRITICAL STEP:** Verify that Apache started correctly. If this fails, the test is invalid.
    sudo systemctl status apache2

3.  If the status is "active (running)", you are good to go.
4.  If the status is "failed", it means there is an error in your `.conf` file (e.g., a typo, or a missing certificate file). Read the full error message to fix it:
    sudo journalctl -xe

### Step 5: Run the Nmap Test

1.  Now that the server is running with the correct configuration for this test, execute your NSE script:

    nmap -p 443 --script=/home/kali/.local/share/nmap/scripts/vulnTLSServer.nse localhost -oN test/test01.out

### Step 6: Repeat for the Next Test

To run Test 02:
- Go to Step 1 and use `openssl_test02.txt` to generate `test02_cert.pem` and `test02_key.pem`.
- Go to Step 2 and move the `test02_cert.pem` and `test02_key.pem` files.
- Go to Step 3 and copy `default-ssl-test02.conf` over the active `default-ssl.conf`.
- Restart, Verify, and Scan.
- Repeat for all other tests.